{{template "org/settings/layout_head" .}}
<div class="org-setting-content">
	<h4 class="ui top attached header">
		{{.locale.Tr "actions.actions"}}
	</h4>
	<div class="ui attached segment">
		<div class="ui grid">
			<div class="sixteen wide column">
				<form class="ui form" action="{{.Link}}" method="post">
					{{.CsrfTokenHtml}}
					<div class="field">
						<label>{{.locale.Tr "actions.general.token_permissions.mode"}}</label>
						<div class="grouped fields">
							<div class="field">
								<div class="ui radio checkbox">
									<input type="radio" name="token_permission_mode" value="{{.TokenPermissionModePermissive}}" {{if eq .TokenPermissionMode .TokenPermissionModePermissive}}checked{{end}}>
									<label>{{.locale.Tr "actions.general.token_permissions.permissive"}}</label>
									<p class="help">{{.locale.Tr "actions.general.token_permissions.permissive.description"}}</p>
								</div>
							</div>
							<div class="field">
								<div class="ui radio checkbox">
									<input type="radio" name="token_permission_mode" value="{{.TokenPermissionModeRestricted}}" {{if eq .TokenPermissionMode .TokenPermissionModeRestricted}}checked{{end}}>
									<label>{{.locale.Tr "actions.general.token_permissions.restricted"}}</label>
									<p class="help">{{.locale.Tr "actions.general.token_permissions.restricted.description"}}</p>
								</div>
							</div>
							<div class="field">
								<div class="ui radio checkbox">
									<input type="radio" name="token_permission_mode" value="custom" {{if eq .TokenPermissionMode .TokenPermissionModeCustom}}checked{{end}}>
									<label>{{.locale.Tr "actions.general.token_permissions.custom"}}</label>
									<p class="help">{{.locale.Tr "actions.general.token_permissions.custom.description"}}</p>
								</div>
							</div>
						</div>
					</div>

					<div id="custom-permissions" class="ui segment" style="display: none;">
						<h5 class="ui header">{{.locale.Tr "actions.general.token_permissions.individual"}}</h5>
						<div class="ui grid">
							<!-- Actions -->
							<div class="eight wide column">
								<div class="field">
									<label>{{.locale.Tr "actions.actions"}}</label>
									<div class="ui checkbox">
										<input type="checkbox" name="actions_read" {{if call $.DefaultTokenPermissions.HasRead "actions"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_read"}}</label>
									</div>
									<div class="ui checkbox">
										<input type="checkbox" name="actions_write" {{if call $.DefaultTokenPermissions.HasWrite "actions"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_write"}}</label>
									</div>
								</div>
							</div>
							<!-- Contents -->
							<div class="eight wide column">
								<div class="field">
									<label>{{.locale.Tr "general.token_permissions.contents"}}</label>
									<div class="ui checkbox">
										<input type="checkbox" name="contents_read" {{if call $.DefaultTokenPermissions.HasRead "contents"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_read"}}</label>
									</div>
									<div class="ui checkbox">
										<input type="checkbox" name="contents_write" {{if call $.DefaultTokenPermissions.HasWrite "contents"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_write"}}</label>
									</div>
								</div>
							</div>
							<!-- Issues -->
							<div class="eight wide column">
								<div class="field">
									<label>{{.locale.Tr "general.token_permissions.issues"}}</label>
									<div class="ui checkbox">
										<input type="checkbox" name="issues_read" {{if call $.DefaultTokenPermissions.HasRead "issues"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_read"}}</label>
									</div>
									<div class="ui checkbox">
										<input type="checkbox" name="issues_write" {{if call $.DefaultTokenPermissions.HasWrite "issues"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_write"}}</label>
									</div>
								</div>
							</div>
							<!-- Packages -->
							<div class="eight wide column">
								<div class="field">
									<label>{{.locale.Tr "general.token_permissions.packages"}}</label>
									<div class="ui checkbox">
										<input type="checkbox" name="packages_read" {{if call $.DefaultTokenPermissions.HasRead "packages"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_read"}}</label>
									</div>
									<div class="ui checkbox">
										<input type="checkbox" name="packages_write" {{if call $.DefaultTokenPermissions.HasWrite "packages"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_write"}}</label>
									</div>
								</div>
							</div>
							<!-- Pull Requests -->
							<div class="eight wide column">
								<div class="field">
									<label>{{.locale.Tr "general.token_permissions.pull_requests"}}</label>
									<div class="ui checkbox">
										<input type="checkbox" name="pull_requests_read" {{if call $.DefaultTokenPermissions.HasRead "pull_requests"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_read"}}</label>
									</div>
									<div class="ui checkbox">
										<input type="checkbox" name="pull_requests_write" {{if call $.DefaultTokenPermissions.HasWrite "pull_requests"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_write"}}</label>
									</div>
								</div>
							</div>
							<!-- Wiki -->
							<div class="eight wide column">
								<div class="field">
									<label>{{.locale.Tr "general.token_permissions.wiki"}}</label>
									<div class="ui checkbox">
										<input type="checkbox" name="wiki_read" {{if call $.DefaultTokenPermissions.HasRead "wiki"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_read"}}</label>
									</div>
									<div class="ui checkbox">
										<input type="checkbox" name="wiki_write" {{if call $.DefaultTokenPermissions.HasWrite "wiki"}}checked{{end}}>
										<label>{{.locale.Tr "general.token_permissions.access_write"}}</label>
									</div>
								</div>
							</div>
						</div>
					</div>

					<h4 class="ui dividing header">{{.locale.Tr "actions.general.token_permissions.cross_repo"}}</h4>
					<div class="field">
						<div class="ui checkbox">
							<input type="checkbox" name="allow_cross_repo_access" {{if .AllowCrossRepoAccess}}checked{{end}}>
							<label>{{.locale.Tr "actions.general.token_permissions.cross_repo_desc"}}</label>
						</div>
					</div>

					<div class="field">
						<button class="ui green button">{{.locale.Tr "save"}}</button>
					</div>
				</form>
			</div>
		</div>
			<div class="divider"></div>
			<h5 class="ui header">{{ctx.Locale.Tr "general.token_permissions.maximum"}}</h5>
			<p class="tw-text-secondary">{{ctx.Locale.Tr "general.token_permissions.maximum.description"}}</p>
			<div class="ui grid">
				<!-- Actions -->
				<div class="eight wide column">
					<div class="field">
						<label>{{ctx.Locale.Tr "actions.actions"}}</label>
						<div class="ui checkbox">
							<input type="checkbox" name="max_actions_read" {{if call $.MaxTokenPermissions.HasRead "actions"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_read"}}</label>
						</div>
						<div class="ui checkbox">
							<input type="checkbox" name="max_actions_write" {{if call $.MaxTokenPermissions.HasWrite "actions"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_write"}}</label>
						</div>
					</div>
				</div>
				<!-- Contents -->
				<div class="eight wide column">
					<div class="field">
						<label>{{ctx.Locale.Tr "general.token_permissions.contents"}}</label>
						<div class="ui checkbox">
							<input type="checkbox" name="max_contents_read" {{if call $.MaxTokenPermissions.HasRead "contents"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_read"}}</label>
						</div>
						<div class="ui checkbox">
							<input type="checkbox" name="max_contents_write" {{if call $.MaxTokenPermissions.HasWrite "contents"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_write"}}</label>
						</div>
					</div>
				</div>
				<!-- Issues -->
				<div class="eight wide column">
					<div class="field">
						<label>{{ctx.Locale.Tr "general.token_permissions.issues"}}</label>
						<div class="ui checkbox">
							<input type="checkbox" name="max_issues_read" {{if call $.MaxTokenPermissions.HasRead "issues"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_read"}}</label>
						</div>
						<div class="ui checkbox">
							<input type="checkbox" name="max_issues_write" {{if call $.MaxTokenPermissions.HasWrite "issues"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_write"}}</label>
						</div>
					</div>
				</div>
				<!-- Packages -->
				<div class="eight wide column">
					<div class="field">
						<label>{{ctx.Locale.Tr "general.token_permissions.packages"}}</label>
						<div class="ui checkbox">
							<input type="checkbox" name="max_packages_read" {{if call $.MaxTokenPermissions.HasRead "packages"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_read"}}</label>
						</div>
						<div class="ui checkbox">
							<input type="checkbox" name="max_packages_write" {{if call $.MaxTokenPermissions.HasWrite "packages"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_write"}}</label>
						</div>
					</div>
				</div>
				<!-- Pull Requests -->
				<div class="eight wide column">
					<div class="field">
						<label>{{ctx.Locale.Tr "general.token_permissions.pull_requests"}}</label>
						<div class="ui checkbox">
							<input type="checkbox" name="max_pull_requests_read" {{if call $.MaxTokenPermissions.HasRead "pull_requests"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_read"}}</label>
						</div>
						<div class="ui checkbox">
							<input type="checkbox" name="max_pull_requests_write" {{if call $.MaxTokenPermissions.HasWrite "pull_requests"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_write"}}</label>
						</div>
					</div>
				</div>
				<!-- Wiki -->
				<div class="eight wide column">
					<div class="field">
						<label>{{ctx.Locale.Tr "general.token_permissions.wiki"}}</label>
						<div class="ui checkbox">
							<input type="checkbox" name="max_wiki_read" {{if call $.MaxTokenPermissions.HasRead "wiki"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_read"}}</label>
						</div>
						<div class="ui checkbox">
							<input type="checkbox" name="max_wiki_write" {{if call $.MaxTokenPermissions.HasWrite "wiki"}}checked{{end}}>
							<label>{{ctx.Locale.Tr "general.token_permissions.access_write"}}</label>
						</div>
					</div>
				</div>
			</div>

	</div>
</div>
{{template "org/settings/layout_footer" .}}

<script>
window.addEventListener('load', function() {
	const customPerms = document.getElementById('custom-permissions');
	const radios = document.querySelectorAll('input[name="token_permission_mode"]');

	function toggleCustom() {
		const selected = document.querySelector('input[name="token_permission_mode"]:checked');
		if (selected && selected.value === 'custom') {
			customPerms.style.display = 'block';
		} else {
			customPerms.style.display = 'none';
		}
	}

	radios.forEach(r => r.addEventListener('change', toggleCustom));
	toggleCustom();
});
</script>
