{{template "base/head" .}}
<div role="main" aria-label="{{.Title}}" class="page-content organization members">
	{{template "org/header" .}}
	<div class="ui container">
		{{template "base/alert" .}}

		{{if .IsOrganizationOwner}}
			<div class="flex-text-block tw-justify-end tw-gap-x-1 tw-gap-y-2 tw-mb-4">
				<button class="ui primary button show-modal" data-modal="#add-member-to-team-modal"
				>
					{{svg "octicon-plus"}}
					{{ctx.Locale.Tr "org.teams.add_team_member"}}
				</button>
			</div>
			<div class="divider"></div>
		{{end}}

		<div class="flex-list">
			{{range .Members}}
				{{$isPublic := index $.MembersIsPublicMember .ID}}
				<div class="flex-item {{if $.PublicOnly}}tw-items-center{{end}}">
					<div class="flex-item-leading">
						<a href="{{.HomeLink}}">{{ctx.AvatarUtils.Avatar . 48}}</a>
					</div>
					<div class="flex-item-main">
						<div class="flex-item-title">
							{{template "shared/user/name" .}}
							{{if not $isPublic}}
								<span class="ui basic tiny label">{{ctx.Locale.Tr "org.members.private"}}</span>
							{{end}}
						</div>
						{{if not $.PublicOnly}}
							<div class="flex-item-body">
								{{ctx.Locale.Tr "org.members.member_role"}}
								<strong class="flex-text-inline">{{if index $.MembersIsUserOrgOwner .ID}}{{svg "octicon-shield-lock"}} {{ctx.Locale.Tr "org.members.owner"}}{{else}}{{ctx.Locale.Tr "org.members.member"}}{{end}}</strong>
							</div>
							{{if $.IsOrganizationOwner}}
							<div class="flex-item-body">
								{{ctx.Locale.Tr "admin.users.2fa"}}
								<strong>
									{{if index $.MembersTwoFaStatus .ID}}
										<span class="text green">{{svg "octicon-check"}}</span>
									{{else}}
										{{svg "octicon-x"}}
									{{end}}
								</strong>
							</div>
							{{end}}
						{{end}}
					</div>
					<div class="flex-item-trailing">
						{{if or (eq $.SignedUser.ID .ID) $.IsOrganizationOwner}}
							{{if $isPublic}}
								<a class="ui tiny button link-action" href data-url="{{$.OrgLink}}/members/action/private?uid={{.ID}}">{{svg "octicon-eye-closed" 12 "icon"}}{{ctx.Locale.Tr "org.members.public_helper"}}</a>
							{{else}}
								<a class="ui tiny button link-action" href data-url="{{$.OrgLink}}/members/action/public?uid={{.ID}}">{{svg "octicon-eye" 12 "icon"}}{{ctx.Locale.Tr "org.members.private_helper"}}</a>
							{{end}}
						{{end}}
						{{if eq $.SignedUser.ID .ID}}
							<form>
								<button class="ui red tiny button delete-button" data-modal-id="leave-organization"
									data-url="{{$.OrgLink}}/members/action/leave" data-datauid="{{.ID}}"
									data-name="{{.DisplayName}}"
									data-data-organization-name="{{$.Org.DisplayName}}">{{ctx.Locale.Tr "org.members.leave"}}</button>
							</form>
						{{else if $.IsOrganizationOwner}}
							<form>
								<button class="ui red tiny button delete-button" data-modal-id="remove-organization-member"
									data-url="{{$.OrgLink}}/members/action/remove" data-datauid="{{.ID}}"
									data-name="{{.DisplayName}}"
									data-data-organization-name="{{$.Org.DisplayName}}">{{ctx.Locale.Tr "org.members.remove"}}</button>
							</form>
						{{end}}
					</div>
				</div>
			{{end}}
		</div>

		{{template "base/paginate" .}}
	</div>
</div>
<div class="ui g-modal-confirm delete modal" id="leave-organization">
	<div class="header">
		{{ctx.Locale.Tr "org.members.leave"}}
	</div>
	<div class="content">
		<p>{{ctx.Locale.Tr "org.members.leave.detail" (HTMLFormat `<span class="%s"></span>` "dataOrganizationName")}}</p>
	</div>
	{{template "base/modal_actions_confirm" .}}
</div>
<div class="ui g-modal-confirm delete modal" id="remove-organization-member">
	<div class="header">
		{{ctx.Locale.Tr "org.members.remove"}}
	</div>
	<div class="content">
		<p>{{ctx.Locale.Tr "org.members.remove.detail" (HTMLFormat `<span class="%s"></span>` "name") (HTMLFormat `<span class="%s"></span>` "dataOrganizationName")}}</p>
	</div>
	{{template "base/modal_actions_confirm" .}}
</div>

<div class="ui small modal" id="add-member-to-team-modal">
	<div class="header">{{ctx.Locale.Tr "org.teams.add_team_member"}}</div>
	<div class="content">
		<form class="ui form ignore-dirty" method="post" data-action-base-link="{{$.OrgLink}}">
			{{.CsrfTokenHtml}}
			<div class="required field">
				<label>{{ctx.Locale.Tr "org.teams"}}</label>
				<div class="ui dropdown selection search team_add_member_team_search">
					<input name="team" type="hidden">
					{{svg "octicon-triangle-down" 14 "dropdown icon"}}
					<div class="text"></div>
					<div class="menu">
						{{range .Teams}}
							<div class="item" data-value="{{.LowerName}}">{{.Name}}</div>
						{{end}}
					</div>
				</div>
			</div>
			<div class="required field">
				<label>{{ctx.Locale.Tr "org.members"}}</label>
				<div id="search-user-box" class="ui search">
					<div class="ui input">
						<input class="prompt" name="uname" placeholder="{{ctx.Locale.Tr "search.user_kind"}}" autocomplete="off" required>
					</div>
				</div>
			</div>
			<div class="actions">
				<button class="ui cancel button">{{ctx.Locale.Tr "cancel"}}</button>
				<button type="submit" class="ui primary button">{{ctx.Locale.Tr "save"}}</button>
			</div>
		</form>
	</div>
</div>

{{template "base/footer" .}}
