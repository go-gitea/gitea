{{/* Template Attributes:
* CommitStatus: summary of all commit status state
* CommitStatuses: all commit status elements
* ShowHideChecks: whether use a button to show/hide the checks
* StatusCheckData: additional status check data for repo/issue/view_content/pull_merge_box
  - MissingRequiredChecks: list of missing required checks
  - IsContextRequired: function to check whether a context is required
  - RequireApproval: whether approval is required for workflow runs
  - CanApprove: whether the user can approve workflow runs
  - ApproveActionLink: link to approve all checks
*/}}

{{if .CommitStatus}}
<div class="commit-status-panel">
	<div class="ui top attached header commit-status-header">
		{{if or (eq .CommitStatus.State "pending") (.MissingRequiredChecks)}}
			{{ctx.Locale.Tr "repo.pulls.status_checking"}}
		{{else if eq .CommitStatus.State "success"}}
			{{ctx.Locale.Tr "repo.pulls.status_checks_success"}}
		{{else if eq .CommitStatus.State "warning"}}
			{{ctx.Locale.Tr "repo.pulls.status_checks_warning"}}
		{{else if eq .CommitStatus.State "failure"}}
			{{ctx.Locale.Tr "repo.pulls.status_checks_failure"}}
		{{else if eq .CommitStatus.State "error"}}
			{{ctx.Locale.Tr "repo.pulls.status_checks_error"}}
		{{else}}
			{{ctx.Locale.Tr "repo.pulls.status_checking"}}
		{{end}}

		<div class="ui right">
			{{if and .StatusCheckData .StatusCheckData.RequireApproval .StatusCheckData.CanApprove}}
				<form method="post" action="{{.StatusCheckData.ApproveActionLink}}">
					{{ctx.RootData.CsrfTokenHtml}}
					<button type="submit" class="ui basic small compact button">
						{{ctx.Locale.Tr "repo.pulls.status_checks_approve_all"}}
					</button>
				</form>
			{{end}}
			{{if .ShowHideChecks}}
				<button class="commit-status-hide-checks btn interact-fg"
				data-show-all="{{ctx.Locale.Tr "repo.pulls.status_checks_show_all"}}"
				data-hide-all="{{ctx.Locale.Tr "repo.pulls.status_checks_hide_all"}}">
				{{ctx.Locale.Tr "repo.pulls.status_checks_hide_all"}}</button>
			{{end}}
		</div>
	</div>

	<div class="commit-status-list">
		{{range .CommitStatuses}}
			<div class="commit-status-item">
				{{template "repo/commit_status" .}}
				<div class="status-context gt-ellipsis">{{.Context}} <span class="text light-2">{{.Description}}</span></div>
				<div class="ui status-details">
					{{if and $.StatusCheckData $.StatusCheckData.IsContextRequired}}
						{{if (call $.StatusCheckData.IsContextRequired .Context)}}<div class="ui label">{{ctx.Locale.Tr "repo.pulls.status_checks_requested"}}</div>{{end}}
					{{end}}
					<span>{{if .TargetURL}}<a href="{{.TargetURL}}">{{ctx.Locale.Tr "repo.pulls.status_checks_details"}}</a>{{end}}</span>
				</div>
			</div>
		{{end}}
		{{if .StatusCheckData}}
			{{range .StatusCheckData.MissingRequiredChecks}}
				<div class="commit-status-item">
					{{svg "octicon-dot-fill" 18 "commit-status icon text yellow"}}
					<div class="status-context gt-ellipsis">{{.}}</div>
					<div class="ui label">{{ctx.Locale.Tr "repo.pulls.status_checks_requested"}}</div>
				</div>
			{{end}}
		{{end}}
	</div>
</div>
{{end}}
