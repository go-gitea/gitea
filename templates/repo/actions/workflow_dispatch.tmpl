<script type="module">
	$('#runWorkflowDispatchForm').form({
		fields: {
			required_input : 'empty',
			number: 'number',
			required_number: ['number', 'empty']
		}
	});
</script>

<div class="ui ignored info message">
	This workflow has a workflow_dispatch event trigger.
	<button class="ui right floated mini button" onclick="$('#runWorkflowDispatchModal').modal('show');">{{ctx.Locale.Tr "actions.workflow.run"}}{{svg "octicon-triangle-down" 14 "dropdown icon"}}</button>
</div>
<div id="runWorkflowDispatchModal" class="ui mini modal">
	<div class="content">
		<form id="runWorkflowDispatchForm" class="ui form" action="{{$.Link}}/run?workflow={{$.CurWorkflow}}&actor={{$.CurActor}}&status={{.Status}}" method="post">
			{{.CsrfTokenHtml}}
			<div class="ui inline field required">
				<label>{{ctx.Locale.Tr "actions.workflow.from_ref"}} :</label>
				<div class="ui floating dropdown icon button">
					<input type="hidden" name="ref" value="refs/heads/{{index .Branches 0}}">
					<i>{{svg "octicon-git-branch"}}</i>
					<span class="text">{{index .Branches 0}}</span>
					<div class="menu">
						<div class="ui icon search input">
							<i class="search icon"></i>
							<input type="text" placeholder="{{ctx.Locale.Tr "repo.filter_branch_and_tag"}}">
						</div>
						<div class="scrolling menu">
							<div class="header">
								{{svg "octicon-git-branch"}}
								Branches
							</div>
							{{range $key, $item := .Branches}}
							<div class="item {{if eq $key 0}}active selected{{end}}" data-value="refs/heads/{{.}}">{{.}}</div>
							{{end}}
							<div class="divider"></div>
							<div class="header">
								{{svg "octicon-tag"}}
								Tags
							</div>
							{{range $key, $item := .Tags}}
							<div class="item" data-value="refs/tags/{{.}}">{{.}}</div>
							{{end}}
						</div>
					</div>
				</div>
			</div>

			<div class="divider"></div>
			{{range $key, $item := .WorkflowDispatchConfig.Inputs}}
			<div class="ui field {{if .Required}}required{{end}}">
				{{if eq .Type "choice"}}
					<label>{{$key}} :</label>
					<select class="ui fluid dropdown" name="{{$key}}">
						{{range .Options}}
						<option value="{{.}}" {{if eq $item.Default .}}selected{{end}} >{{.}}</option>
						{{end}}
					</select>
					<span class="help">{{.Description}}</span>
				{{else if eq .Type "boolean"}}
					<div class="ui inline toggle checkbox">
						<label>{{$key}}</label>
						<input type="checkbox" name="{{$key}}" {{if eq .Default "true"}}checked{{end}}>
						<span class="help">{{.Description}}</span>
					</div>
				{{else if eq .Type "number"}}
					<label>{{$key}} :</label>
					<input name="{{$key}}" value="{{.Default}}" data-validate="{{if .Required}}required_{{end}}number">
					<span class="help">{{.Description}}</span>
				{{else}}
					<label>{{$key}} :</label>
					<input name="{{$key}}" value="{{.Default}}" {{if .Required}}data-validate="required_input"{{end}}>
					<span class="help">{{.Description}}</span>
				{{end}}
			</div>
			{{end}}
			<button class="ui tiny blue button" type="submit">Submit</button>
		</form>
	</div>
</div>
