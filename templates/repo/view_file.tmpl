<div {{if .ReadmeInList}}id="readme"{{end}} class="{{TabSizeClass .Editorconfig .FileTreePath}} non-diff-file-content"
	data-global-init="initRepoFileView" data-raw-file-link="{{.RawFileLink}}">

	{{- if .FileError}}
		<div class="ui error message">
			<div class="text left tw-whitespace-pre">{{.FileError}}</div>
		</div>
	{{end}}
	{{- if .FileWarning}}
		<div class="ui warning message">
			<div class="text left tw-whitespace-pre">{{.FileWarning}}</div>
		</div>
	{{end}}

	{{if not .ReadmeInList}}
		<div id="repo-file-commit-box" class="ui segment list-header tw-mb-4 tw-flex tw-justify-between">
			{{template "repo/latest_commit" .}}
			{{if .LatestCommit}}
				{{if .LatestCommit.Committer}}
					<div class="text grey age flex-text-block">
						{{DateUtils.TimeSince .LatestCommit.Committer.When}}
					</div>
				{{end}}
			{{end}}
		</div>
	{{end}}

	<h4 class="file-header ui top attached header tw-flex tw-items-center tw-justify-between tw-flex-wrap">
		<div class="file-header-left tw-flex tw-items-center tw-py-2 tw-pr-4">
			{{if .ReadmeInList}}
				{{svg "octicon-book" 16 "tw-mr-2"}}
				<strong><a class="muted" href="#readme">{{.ReadmeInList}}</a></strong>
			{{else}}
				{{template "repo/file_info" .}}
			{{end}}
		</div>
		<div class="file-header-right file-actions flex-text-block tw-flex-wrap">
			{{/* this componment is also controlled by frontend plugin renders */}}
			<div class="ui compact icon buttons file-view-toggle-buttons {{Iif .HasSourceRenderedToggle "" "tw-hidden"}}">
				{{if .IsRepresentableAsText}}
				<a href="?display=source" class="ui mini basic button file-view-toggle-source {{if .IsDisplayingSource}}active{{end}}" data-tooltip-content="{{ctx.Locale.Tr "repo.file_view_source"}}">{{svg "octicon-code" 15}}</a>
				{{end}}
				<a href="?display=rendered" class="ui mini basic button file-view-toggle-rendered {{if not .IsDisplayingSource}}active{{end}}" data-tooltip-content="{{ctx.Locale.Tr "repo.file_view_rendered"}}">{{svg "octicon-file" 15}}</a>
			</div>
			{{if not .ReadmeInList}}
				<div class="ui buttons tw-mr-1">
					<a class="ui mini basic button" href="{{$.RawFileLink}}">{{ctx.Locale.Tr "repo.file_raw"}}</a>
					{{if or .RefFullName.IsBranch .RefFullName.IsTag}}
						<a class="ui mini basic button" href="{{.RepoLink}}/src/commit/{{PathEscape .CommitID}}/{{PathEscapeSegments .TreePath}}">{{ctx.Locale.Tr "repo.file_permalink"}}</a>
					{{end}}
					{{if .IsRepresentableAsText}}
						<a class="ui mini basic button" href="{{.RepoLink}}/blame/{{.RefTypeNameSubURL}}/{{PathEscapeSegments .TreePath}}">{{ctx.Locale.Tr "repo.blame"}}</a>
					{{end}}
					<a class="ui mini basic button" href="{{.RepoLink}}/commits/{{.RefTypeNameSubURL}}/{{PathEscapeSegments .TreePath}}">{{ctx.Locale.Tr "repo.file_history"}}</a>
					{{if .EscapeStatus.Escaped}}
						<button class="ui mini basic button unescape-button tw-hidden">{{ctx.Locale.Tr "repo.unescape_control_characters"}}</button>
						<button class="ui mini basic button escape-button">{{ctx.Locale.Tr "repo.escape_control_characters"}}</button>
					{{end}}
				</div>
				<a download class="btn-octicon" data-tooltip-content="{{ctx.Locale.Tr "repo.download_file"}}" href="{{$.RawFileLink}}">{{svg "octicon-download"}}</a>
				<a class="btn-octicon {{if not .CanCopyContent}}disabled{{end}}" data-global-click="onCopyContentButtonClick"
					{{if not .IsDisplayingSource}}data-raw-file-link="{{$.RawFileLink}}"{{end}}
					data-tooltip-content="{{if .CanCopyContent}}{{ctx.Locale.Tr "copy_content"}}{{else}}{{ctx.Locale.Tr "copy_type_unsupported"}}{{end}}"
				>{{svg "octicon-copy"}}</a>
				{{if .EnableFeed}}
				<a class="btn-octicon" href="{{$.RepoLink}}/rss/{{$.RefTypeNameSubURL}}/{{PathEscapeSegments .TreePath}}" data-tooltip-content="{{ctx.Locale.Tr "rss_feed"}}">
					{{svg "octicon-rss"}}
				</a>
				{{end}}
				{{if .Repository.CanEnableEditor}}
					{{if .CanEditFile}}
						<a class="btn-octicon" data-tooltip-content="{{.EditFileTooltip}}" href="{{.RepoLink}}/_edit/{{PathEscapeSegments .BranchName}}/{{PathEscapeSegments .TreePath}}">{{svg "octicon-pencil"}}</a>
					{{else}}
						<span class="btn-octicon disabled" data-tooltip-content="{{.EditFileTooltip}}">{{svg "octicon-pencil"}}</span>
					{{end}}
					{{if .CanDeleteFile}}
						<a type="button" class="btn-octicon btn-octicon-danger" data-tooltip-content="{{.DeleteFileTooltip}}" id="delete-file-button">{{svg "octicon-trash"}}</a>
					{{else}}
						<span class="btn-octicon disabled" data-tooltip-content="{{.DeleteFileTooltip}}">{{svg "octicon-trash"}}</span>
					{{end}}
				{{end}}
			{{else if .EscapeStatus.Escaped}}
				<button class="ui mini basic button unescape-button tw-mr-1 tw-hidden">{{ctx.Locale.Tr "repo.unescape_control_characters"}}</button>
				<button class="ui mini basic button escape-button tw-mr-1">{{ctx.Locale.Tr "repo.escape_control_characters"}}</button>
			{{end}}
			{{if and .ReadmeInList .CanEditReadmeFile}}
				<a class="btn-octicon" data-tooltip-content="{{ctx.Locale.Tr "repo.editor.edit_this_file"}}" href="{{.RepoLink}}/_edit/{{PathEscapeSegments .BranchName}}/{{PathEscapeSegments .FileTreePath}}">{{svg "octicon-pencil"}}</a>
			{{end}}
		</div>
	</h4>

	<div class="ui bottom attached table unstackable segment">
		{{if not .IsMarkup}}
			{{template "repo/unicode_escape_prompt" dict "EscapeStatus" .EscapeStatus}}
		{{end}}
		<div class="file-view {{if .IsMarkup}}markup {{.MarkupType}}{{else if .IsPlainText}}plain-text{{else if .IsDisplayingSource}}code-view{{end}}">
			{{if .IsFileTooLarge}}
				{{template "shared/filetoolarge" dict "RawFileLink" .RawFileLink}}
			{{else if not .FileSize}}
				{{template "shared/fileisempty"}}
			{{else if .IsMarkup}}
				{{.FileContent}}
			{{else if .IsPlainText}}
				<pre>{{if .FileContent}}{{.FileContent}}{{end}}</pre>
			{{else if .FileContent}}
				<table>
					<tbody>
					{{range $idx, $code := .FileContent}}
						{{$line := Eval $idx "+" 1}}
						<tr>
							<td class="lines-num"><span id="L{{$line}}" data-line-number="{{$line}}"></span></td>
							{{if $.EscapeStatus.Escaped}}
								<td class="lines-escape">{{if (index $.LineEscapeStatus $idx).Escaped}}<button class="toggle-escape-button btn interact-bg" title="{{if (index $.LineEscapeStatus $idx).HasInvisible}}{{ctx.Locale.Tr "repo.invisible_runes_line"}} {{end}}{{if (index $.LineEscapeStatus $idx).HasAmbiguous}}{{ctx.Locale.Tr "repo.ambiguous_runes_line"}}{{end}}"></button>{{end}}</td>
							{{end}}
							<td rel="L{{$line}}" class="lines-code chroma"><code class="code-inner">{{$code}}</code></td>
						</tr>
					{{end}}
					</tbody>
				</table>
			{{else}}
				<div class="view-raw">
					{{if .IsImageFile}}
						<img alt="{{$.RawFileLink}}" src="{{$.RawFileLink}}">
					{{else if .IsVideoFile}}
						<video controls src="{{$.RawFileLink}}">
							<strong>{{ctx.Locale.Tr "repo.video_not_supported_in_browser"}}</strong>
						</video>
					{{else if .IsAudioFile}}
						<audio controls src="{{$.RawFileLink}}">
							<strong>{{ctx.Locale.Tr "repo.audio_not_supported_in_browser"}}</strong>
						</audio>
					{{else}}
						<div class="file-view-render-container">
							<div class="file-view-raw-prompt tw-p-4">
								<a href="{{$.RawFileLink}}" rel="nofollow">{{ctx.Locale.Tr "repo.file_view_raw"}}</a>
							</div>
						</div>
					{{end}}
				</div>
			{{end}}
		</div>

		<div class="code-line-menu tippy-target">
			{{if $.Permission.CanRead ctx.Consts.RepoUnitTypeIssues}}
			<a class="item ref-in-new-issue" role="menuitem" data-url-issue-new="{{.RepoLink}}/issues/new" data-url-param-body-link="{{.Repository.Link}}/src/commit/{{PathEscape .CommitID}}/{{PathEscapeSegments .TreePath}}{{if $.HasSourceRenderedToggle}}?display=source{{end}}" rel="nofollow noindex">{{ctx.Locale.Tr "repo.issues.context.reference_issue"}}</a>
			{{end}}
			<a class="item view_git_blame" role="menuitem" href="{{.Repository.Link}}/blame/commit/{{PathEscape .CommitID}}/{{PathEscapeSegments .TreePath}}">{{ctx.Locale.Tr "repo.view_git_blame"}}</a>
			<a class="item copy-line-permalink" role="menuitem" data-url="{{.Repository.Link}}/src/commit/{{PathEscape .CommitID}}/{{PathEscapeSegments .TreePath}}{{if $.HasSourceRenderedToggle}}?display=source{{end}}">{{ctx.Locale.Tr "repo.file_copy_permalink"}}</a>
		</div>
	</div>

	{{/* Delete File Modal */}}
	{{if .CanDeleteFile}}
	<div class="ui modal" id="delete-file-modal">
		<i class="close icon"></i>
		<div class="content">
			<form id="delete-file-form" class="ui form form-fetch-action" method="post" action="{{.RepoLink}}/_delete/{{.BranchName | PathEscapeSegments}}/{{.TreePath | PathEscapeSegments}}">
				{{.CsrfTokenHtml}}
				<input type="hidden" name="last_commit" value="{{.CommitID}}">
				<input type="hidden" name="tree_path" value="{{.TreePath}}">
				<div class="commit-form-wrapper">
					{{ctx.AvatarUtils.Avatar .SignedUser 40 "commit-avatar"}}
					<div class="commit-form avatar-content-left-arrow">
						<h3>
							<span>{{svg "octicon-unlock" 24}}</span>
							{{ctx.Locale.Tr "repo.editor.commit_changes"}}
						</h3>
						<div class="field">
							<input name="commit_summary" maxlength="100" placeholder="Delete {{.TreePath}}" value="Delete {{.TreePath}}" autofocus>
						</div>
						<div class="field">
							<textarea name="commit_message" placeholder="{{ctx.Locale.Tr "repo.editor.commit_message_desc"}}" rows="5"></textarea>
						</div>
						<div class="inline field">
							<div class="ui checkbox">
								<input name="signoff" type="checkbox">
								<label>{{ctx.Locale.Tr "repo.editor.signoff_desc"}}</label>
							</div>
						</div>
						<div class="quick-pull-choice">
							<div class="field">
								<div class="ui radio checkbox">
									<input type="radio" name="commit_choice" value="direct" checked>
									<label>
										{{svg "octicon-git-commit"}}
										{{ctx.Locale.Tr "repo.editor.commit_directly_to_this_branch" .BranchName}}
									</label>
								</div>
							</div>
							{{if not .Repository.IsEmpty}}
								<div class="field">
									<div class="ui radio checkbox">
										<input type="radio" name="commit_choice" value="commit-to-new-branch">
										<label>
											{{svg "octicon-git-pull-request"}}
											{{ctx.Locale.Tr "repo.editor.create_new_branch_np"}}
										</label>
									</div>
								</div>
								<div class="quick-pull-branch-name tw-hidden">
									<div class="new-branch-name-input field">
										{{svg "octicon-git-branch"}}
										<input type="text" name="new_branch_name" maxlength="100" value="{{.new_branch_name}}" class="input-contrast tw-mr-1" placeholder="{{ctx.Locale.Tr "repo.editor.new_branch_name_desc"}}" title="{{ctx.Locale.Tr "repo.editor.new_branch_name"}}">
										<span class="text-muted"></span>
									</div>
								</div>
							{{end}}
						</div>
					</div>
				</div>
				<div class="tw-text-right tw-mt-4">
					<button type="button" class="ui button" onclick="$('#delete-file-modal').modal('hide')">{{ctx.Locale.Tr "cancel"}}</button>
					<button type="submit" class="ui red button">
						{{svg "octicon-trash" 16}}
						{{ctx.Locale.Tr "repo.editor.delete_this_file"}}
					</button>
				</div>
			</form>
		</div>
	</div>
	{{end}}
</div>
